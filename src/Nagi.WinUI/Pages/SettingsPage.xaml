<Page
    x:Class="Nagi.WinUI.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b1="using:Microsoft.Xaml.Interactivity"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:coreModels="using:Nagi.Core.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:localConverters="using:Nagi.WinUI.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Nagi.WinUI.Models"
    xmlns:mux="using:Microsoft.UI.Xaml"
    xmlns:navigation="using:Nagi.WinUI.Navigation"
    xmlns:viewmodels="using:Nagi.WinUI.ViewModels"
    mc:Ignorable="d">

    <Page.Resources>
        <localConverters:ElementThemeToFriendlyStringConverter x:Key="ThemeToStringConverter" />
        <localConverters:BackdropMaterialToStringConverter x:Key="BackdropMaterialToStringConverter" />
        <localConverters:StringToFontFamilyConverter x:Key="StringToFontFamilyConverter" />
        <localConverters:BooleanToOpacityConverter x:Key="BooleanToOpacityConverter" FalseValue="0.4" />
        <localConverters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            MaxWidth="1200"
            Margin="36,24,36,0"
            Style="{StaticResource SettingsPageTitleTextStyle}"
            Text="Settings" />

        <ScrollView
            Grid.Row="1"
            Padding="36,0,36,24"
            VerticalScrollBarVisibility="Auto"
            VerticalScrollMode="Auto">
            <StackPanel
                MaxWidth="1200"
                HorizontalAlignment="Stretch"
                Spacing="{StaticResource SettingsCardSpacing}">
                <StackPanel.ChildrenTransitions>
                    <EntranceThemeTransition FromVerticalOffset="50" />
                    <RepositionThemeTransition IsStaggeringEnabled="False" />
                </StackPanel.ChildrenTransitions>

                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Appearance" />

                <controls:SettingsCard Header="Theme" Description="Choose the application theme.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE793;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox
                        MinWidth="300"
                        HorizontalAlignment="Right"
                        ItemsSource="{x:Bind ViewModel.AvailableThemes}"
                        SelectedItem="{x:Bind ViewModel.SelectedTheme, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="mux:ElementTheme">
                                <TextBlock Text="{Binding Converter={StaticResource ThemeToStringConverter}}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Window Material"
                    Description="Select the backdrop material for the window.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE7C4;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox
                        MinWidth="300"
                        HorizontalAlignment="Right"
                        ItemsSource="{x:Bind ViewModel.AvailableBackdropMaterials}"
                        SelectedItem="{x:Bind ViewModel.SelectedBackdropMaterial, Mode=TwoWay}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="models:BackdropMaterial">
                                <TextBlock
                                    Text="{Binding Converter={StaticResource BackdropMaterialToStringConverter}}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Dynamic Theming"
                    Description="Enable and configure dynamic theming options.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE790;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsDynamicThemingEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Remember window size"
                    Description="Restore the main window to its previous size on next launch.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE740;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsRememberWindowSizeEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Remember navigation panel state"
                    Description="Keep the left navigation panel open or closed as you left it.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE700;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsRememberPaneStateEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Customize Navigation"
                    Description="Drag to reorder pages in the navigation menu. Use the toggle to show or hide a page.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE700;" />
                    </controls:SettingsCard.HeaderIcon>

                    <ListView
                        Width="350"
                        HorizontalAlignment="Right"
                        AllowDrop="True"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CanDragItems="True"
                        CanReorderItems="True"
                        CornerRadius="{StaticResource ControlCornerRadius}"
                        ItemContainerStyle="{StaticResource NavigationListViewItemStyle}"
                        ItemsSource="{x:Bind ViewModel.NavigationItems}"
                        SelectionMode="None">

                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="navigation:NavigationItemSetting">
                                <Grid Padding="12,10" VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="28" />
                                        <ColumnDefinition Width="32" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <FontIcon
                                        Grid.Column="0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontFamily="{StaticResource SymbolThemeFontFamily}"
                                        FontSize="16"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                        Glyph="&#xE784;" />

                                    <FontIcon
                                        Grid.Column="1"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontFamily="{x:Bind IconFontFamily, Converter={StaticResource StringToFontFamilyConverter}}"
                                        Foreground="{ThemeResource AppPrimaryColorBrush}"
                                        Glyph="{x:Bind IconGlyph}" />

                                    <TextBlock
                                        Grid.Column="2"
                                        Margin="8,0,12,0"
                                        VerticalAlignment="Center"
                                        FontWeight="SemiBold"
                                        Text="{x:Bind DisplayName}" />

                                    <ToggleSwitch
                                        Grid.Column="3"
                                        VerticalAlignment="Center"
                                        IsOn="{x:Bind IsEnabled, Mode=TwoWay}" />

                                    <Border
                                        Grid.ColumnSpan="4"
                                        Height="1"
                                        VerticalAlignment="Bottom"
                                        Background="{ThemeResource CardStrokeColorDefaultBrush}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </controls:SettingsCard>

                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Player Management" />

                <controls:SettingsCard
                    Header="Volume Normalization (ReplayGain)"
                    Description="Automatically adjust volume to the standard level (-18 LUFS) to avoid sudden loudness changes.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE995;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsVolumeNormalizationEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Audio Equalizer"
                    Description="Adjust frequency bands to customize your sound.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE9E9;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Spacing="16">
                        <StackPanel Spacing="4">
                            <TextBlock FontWeight="SemiBold" Text="Preamp" />
                            <Slider
                                Maximum="20"
                                Minimum="-20"
                                StepFrequency="0.1"
                                Style="{StaticResource EqualizerSliderStyle}"
                                Value="{x:Bind ViewModel.EqualizerPreamp, Mode=TwoWay}" />
                        </StackPanel>

                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.EqualizerBands}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Horizontal" Spacing="12" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:EqualizerBandViewModel">
                                    <StackPanel Width="40" Spacing="8">
                                        <Slider
                                            Height="150"
                                            HorizontalContentAlignment="Center"
                                            Maximum="20"
                                            Minimum="-20"
                                            Orientation="Vertical"
                                            StepFrequency="0.1"
                                            Style="{StaticResource EqualizerSliderStyle}"
                                            Value="{x:Bind Gain, Mode=TwoWay}" />
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            Style="{ThemeResource CaptionTextBlockStyle}"
                                            Text="{x:Bind FrequencyLabel}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>

                        <StackPanel
                            HorizontalAlignment="Center"
                            Orientation="Horizontal"
                            Spacing="12">
                            <ComboBox
                                MinWidth="160"
                                ItemsSource="{x:Bind ViewModel.AvailableEqualizerPresets}"
                                PlaceholderText="Custom"
                                SelectedItem="{x:Bind ViewModel.SelectedEqualizerPreset, Mode=TwoWay}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="coreModels:EqualizerPreset">
                                        <TextBlock Text="{x:Bind Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button
                                Command="{x:Bind ViewModel.ResetEqualizerCommand}"
                                Content="Reset"
                                Style="{StaticResource SettingsPageResetButtonStyle}"
                                ToolTipService.ToolTip="Reset equalizer to default" />
                        </StackPanel>
                    </StackPanel>
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Customize Player Controls"
                    Description="Drag buttons to reorder them on the player.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE768;" />
                    </controls:SettingsCard.HeaderIcon>

                    <StackPanel Spacing="16" HorizontalAlignment="Right">
                        <Border
                            Width="Auto"
                            MinWidth="520"
                            Height="120"
                            Padding="20,12"
                            HorizontalAlignment="Right"
                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="{StaticResource OverlayCornerRadius}">

                            <Grid>
                                <ListView
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    AllowDrop="True"
                                    CanDragItems="True"
                                    CanReorderItems="True"
                                    ItemsSource="{x:Bind ViewModel.PlayerButtons, Mode=OneWay}"
                                    SelectionMode="None"
                                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                    ScrollViewer.HorizontalScrollMode="Disabled"
                                    ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                    ScrollViewer.VerticalScrollMode="Disabled">

                                    <ListView.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <ItemsStackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ListView.ItemsPanel>

                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="Padding" Value="0" />
                                            <Setter Property="Margin" Value="4,0" />
                                            <Setter Property="MinHeight" Value="0" />
                                            <Setter Property="MinWidth" Value="0" />
                                            <Setter Property="VerticalContentAlignment" Value="Center" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListViewItem">
                                                        <ListViewItemPresenter
                                                            ContentMargin="{TemplateBinding Padding}"
                                                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                                            DragBackground="Transparent"
                                                            DragForeground="{ThemeResource TextFillColorPrimaryBrush}"
                                                            PointerOverBackground="Transparent"
                                                            SelectedBackground="Transparent"
                                                            SelectionCheckMarkVisualEnabled="False" />
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListView.ItemContainerStyle>

                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:PlayerButtonSetting">
                                            <Grid
                                                x:Name="ButtonContainer"
                                                Width="48"
                                                Height="88"
                                                Padding="4"
                                                Background="Transparent"
                                                CornerRadius="8"
                                                ToolTipService.ToolTip="{x:Bind DisplayName}">
                                                <b1:Interaction.Behaviors>
                                                    <b1:EventTriggerBehavior EventName="PointerEntered">
                                                        <b1:ChangePropertyAction
                                                            PropertyName="Visibility"
                                                            TargetObject="{Binding ElementName=EnableDisableToggle}"
                                                            Value="Visible" />
                                                        <b1:ChangePropertyAction
                                                            PropertyName="Visibility"
                                                            TargetObject="{Binding ElementName=DragIndicator}"
                                                            Value="Visible" />
                                                    </b1:EventTriggerBehavior>
                                                    <b1:EventTriggerBehavior EventName="PointerExited">
                                                        <b1:ChangePropertyAction
                                                            PropertyName="Visibility"
                                                            TargetObject="{Binding ElementName=EnableDisableToggle}"
                                                            Value="Collapsed" />
                                                        <b1:ChangePropertyAction
                                                            PropertyName="Visibility"
                                                            TargetObject="{Binding ElementName=DragIndicator}"
                                                            Value="Collapsed" />
                                                    </b1:EventTriggerBehavior>
                                                </b1:Interaction.Behaviors>
                                                <Border
                                                    x:Name="SeparatorVisual"
                                                    Width="2"
                                                    Height="30"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Top"
                                                    Margin="0,24,0,0"
                                                    Background="{ThemeResource TextFillColorSecondaryBrush}"
                                                    CornerRadius="1"
                                                    Visibility="{x:Bind IsSeparator, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                <Grid
                                                    Visibility="{x:Bind IsNotSeparator, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="12" />
                                                        <RowDefinition Height="36" />
                                                        <RowDefinition Height="8" />
                                                        <RowDefinition Height="24" />
                                                        <RowDefinition Height="8" />
                                                    </Grid.RowDefinitions>
                                                    <FontIcon
                                                        x:Name="DragIndicator"
                                                        Grid.Row="0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                        FontSize="10"
                                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                        Glyph="&#xE76F;"
                                                        Visibility="Collapsed" />
                                                    <Button
                                                        Grid.Row="1"
                                                        Width="36"
                                                        Height="36"
                                                        IsHitTestVisible="False"
                                                        Opacity="{x:Bind IsEnabled, Converter={StaticResource BooleanToOpacityConverter}, Mode=OneWay}"
                                                        Style="{StaticResource MediaControlButtonStyle}">
                                                        <FontIcon
                                                            FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                            FontSize="14"
                                                            Glyph="{x:Bind IconGlyph}" />
                                                    </Button>
                                                    <ToggleSwitch
                                                        x:Name="EnableDisableToggle"
                                                        Grid.Row="3"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        MinWidth="0"
                                                        MinHeight="0"
                                                        IsOn="{x:Bind IsEnabled, Mode=TwoWay}"
                                                        OffContent=""
                                                        OnContent=""
                                                        Visibility="Collapsed">
                                                        <ToggleSwitch.Resources>
                                                        </ToggleSwitch.Resources>
                                                    </ToggleSwitch>
                                                </Grid>
                                                <VisualStateManager.VisualStateGroups>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal" />
                                                        <VisualState x:Name="PointerOver">
                                                            <Storyboard>
                                                                <ObjectAnimationUsingKeyFrames
                                                                    Storyboard.TargetName="ButtonContainer"
                                                                    Storyboard.TargetProperty="Background">
                                                                    <DiscreteObjectKeyFrame KeyTime="0"
                                                                        Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                                                                </ObjectAnimationUsingKeyFrames>
                                                                <DoubleAnimation
                                                                    Storyboard.TargetName="ButtonContainer"
                                                                    Storyboard.TargetProperty="Opacity"
                                                                    To="1"
                                                                    Duration="0:0:0.1" />
                                                            </Storyboard>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateManager.VisualStateGroups>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </Border>

                        <TextBlock
                            MaxWidth="450"
                            HorizontalAlignment="Center"
                            Opacity="0.8"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Text="Drag items to reorder. The divider separates the center and the right side."
                            TextAlignment="Center"
                            TextWrapping="Wrap"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Collapsable player"
                    Description="Animate the player bar to expand and collapse.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE745;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsPlayerAnimationEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Restore playback state"
                    Description="Save the current playback state to resume on next launch.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE74E;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsRestorePlaybackStateEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Auto launch on startup"
                    Description="Start Nagi automatically when you log into your computer.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE7E8;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsAutoLaunchEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Start minimized"
                    Description="When launched, the application window will be minimized by default.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE92C;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsStartMinimizedEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Minimize to mini-player"
                    Description="When minimized, show a compact floating player instead of hiding the window.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE975;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsMinimizeToMiniPlayerEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Hide to system tray"
                    Description="When closed, hide to the system tray instead.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE78B;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsHideToTrayEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Show cover art in flyout"
                    Description="Display the cover art in the compact player that appears when clicking the tray icon.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xEB9F;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsShowCoverArtInTrayFlyoutEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Data Management" />

                <controls:SettingsCard
                    Header="Retrieve online metadata"
                    Description="Fetch additional information like artist images and biographies from online services (e.g., Spotify, Last.fm).">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE8EC;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsFetchOnlineMetadataEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Fetch online lyrics"
                    Description="Automatically fetch missing lyrics from LRCLIB. (Privacy: sends track metadata to a third-party service)">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE90A;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsFetchOnlineLyricsEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Export/Import Playlists"
                    Description="Export playlists to M3U files for use in other players, or import M3U playlists into Nagi.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE8B5;" />
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button
                            Content="Export All..."
                            ToolTipService.ToolTip="Export all playlists to a folder"
                            Command="{x:Bind ViewModel.ExportAllPlaylistsCommand}" />
                        <Button
                            Content="Import..."
                            ToolTipService.ToolTip="Import one or more M3U files"
                            Command="{x:Bind ViewModel.ImportMultiplePlaylistsCommand}" />
                    </StackPanel>
                </controls:SettingsCard>

                <controls:SettingsCard
                    Header="Reset application"
                    Description="This will delete all library data, playlists, and reset all settings to their defaults. The application will restart.">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE74D;" />
                    </controls:SettingsCard.HeaderIcon>
                    <Button
                        HorizontalAlignment="Right"
                        Command="{x:Bind ViewModel.ResetApplicationDataCommand}"
                        Content="Reset All Data"
                        Style="{StaticResource SettingsPageResetButtonStyle}" />
                </controls:SettingsCard>

                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Integrations" />

                <controls:SettingsCard
                    Header="Last.fm"
                    Description="Connect your Last.fm account to scrobble tracks and show your currently playing song.">
                    <controls:SettingsCard.HeaderIcon>
                        <PathIcon
                            Data="M10.584 17.209l-.88-2.392s-1.43 1.595-3.573 1.595c-1.897 0-3.244-1.65-3.244-4.289 0-3.381 1.704-4.591 3.382-4.591 2.419 0 3.188 1.567 3.849 3.574l.88 2.75c.879 2.667 2.528 4.811 7.284 4.811 3.409 0 5.719-1.044 5.719-3.793 0-2.227-1.265-3.381-3.629-3.932l-1.76-.385c-1.209-.275-1.566-.77-1.566-1.594 0-.935.742-1.485 1.952-1.485 1.319 0 2.034.495 2.144 1.677l2.749-.33c-.22-2.474-1.924-3.491-4.729-3.491-2.474 0-4.893.935-4.893 3.931 0 1.87.907 3.052 3.188 3.602l1.869.439c1.402.33 1.869.907 1.869 1.705 0 1.017-.989 1.43-2.858 1.43-2.776 0-3.932-1.457-4.591-3.464l-.907-2.749c-1.155-3.574-2.997-4.894-6.653-4.894-4.041-.001-6.186 2.556-6.186 6.899 0 4.179 2.145 6.433 5.993 6.433 3.107.001 4.591-1.457 4.591-1.457z"
                            Foreground="{ThemeResource TextFillColorPrimaryBrush}" />
                    </controls:SettingsCard.HeaderIcon>

                    <StackPanel
                        HorizontalAlignment="Right"
                        Orientation="Vertical"
                        Spacing="8">
                        <StackPanel
                            Orientation="Vertical"
                            Spacing="8"
                            Visibility="{x:Bind ViewModel.IsLastFmNotConnected, Mode=OneWay}">
                            <Button
                                HorizontalAlignment="Right"
                                Command="{x:Bind ViewModel.LastFmInitialAuthCommand}"
                                Content="Connect to Last.fm"
                                IsEnabled="{x:Bind ViewModel.IsLastFmInitialAuthEnabled, Mode=OneWay}"
                                ToolTipService.ToolTip="Start Last.fm connection" />

                            <Button
                                HorizontalAlignment="Right"
                                Command="{x:Bind ViewModel.LastFmFinalizeAuthCommand}"
                                Content="Complete Connection"
                                Visibility="{x:Bind ViewModel.IsConnectingToLastFm, Mode=OneWay}"
                                ToolTipService.ToolTip="Finalize Last.fm connection" />

                            <TextBlock
                                MaxWidth="250"
                                HorizontalAlignment="Right"
                                Style="{ThemeResource CaptionTextBlockStyle}"
                                Text="After authorizing in your browser, click 'Complete Connection'."
                                TextWrapping="Wrap"
                                Visibility="{x:Bind ViewModel.IsConnectingToLastFm, Mode=OneWay}" />
                        </StackPanel>

                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="12"
                            VerticalAlignment="Center"
                            Visibility="{x:Bind ViewModel.IsLastFmConnected, Mode=OneWay}">
                            <TextBlock VerticalAlignment="Center">
                                <Run Text="Connected as" />
                                <Run FontWeight="SemiBold" Text="{x:Bind ViewModel.LastFmUsername, Mode=OneWay}" />
                            </TextBlock>
                            <Button
                                Command="{x:Bind ViewModel.LastFmDisconnectCommand}"
                                Content="Disconnect"
                                ToolTipService.ToolTip="Disconnect from Last.fm" />
                        </StackPanel>
                    </StackPanel>
                </controls:SettingsCard>

                <StackPanel Spacing="{StaticResource SettingsCardSpacing}"
                            Visibility="{x:Bind ViewModel.IsLastFmConnected, Mode=OneWay}">
                    <controls:SettingsCard
                        Header="Enable scrobbling"
                        Description="Automatically add the tracks you listen to on Nagi to your Last.fm profile.">
                        <controls:SettingsCard.HeaderIcon>
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE121;" />
                        </controls:SettingsCard.HeaderIcon>
                        <ToggleSwitch
                            HorizontalAlignment="Right"
                            IsOn="{x:Bind ViewModel.IsLastFmScrobblingEnabled, Mode=TwoWay}" />
                    </controls:SettingsCard>

                    <controls:SettingsCard
                        Header="Update 'Now Playing'"
                        Description="Show your friends on Last.fm what you're currently listening to in real-time.">
                        <controls:SettingsCard.HeaderIcon>
                            <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE9A8;" />
                        </controls:SettingsCard.HeaderIcon>
                        <ToggleSwitch
                            HorizontalAlignment="Right"
                            IsOn="{x:Bind ViewModel.IsLastFmNowPlayingEnabled, Mode=TwoWay}" />
                    </controls:SettingsCard>
                </StackPanel>

                <controls:SettingsCard
                    Header="Discord"
                    Description="Show your current listening activity as your status on Discord.">
                    <controls:SettingsCard.HeaderIcon>
                        <PathIcon
                            Data="M20.317 4.37C18.787 3.66 17.13 3.15 15.4 2.88C15.4 2.88 15.27 3.04 15.12 3.26C13.24 2.99 11.37 2.99 9.52 3.26C9.37 3.04 9.24 2.88 9.24 2.88C7.51 3.15 5.85 3.66 4.32 4.37C0.93 9.21 0.05 13.93 0.51 18.58C2.6 20.01 4.65 20.89 6.66 21.43C7.15 20.77 7.6 20.07 8 19.33C7.32 19.08 6.67 18.78 6.05 18.43C6.2 18.32 6.34 18.21 6.48 18.09C10.36 19.87 14.64 19.87 18.52 18.09C18.66 18.21 18.8 18.32 18.95 18.43C18.33 18.78 17.68 19.08 17 19.33C17.4 20.07 17.85 20.77 18.34 21.43C20.35 20.89 22.4 20.01 24.49 18.58C25.02 13.21 23.6 8.54 20.317 4.37ZM8.62 15.31C7.27 15.31 6.18 14.08 6.18 12.58C6.18 11.08 7.24 9.84 8.62 9.84C9.99 9.84 11.08 11.07 11.06 12.58C11.06 14.08 9.99 15.31 8.62 15.31ZM16.38 15.31C15.03 15.31 13.94 14.08 13.94 12.58C13.94 11.08 15 9.84 16.38 9.84C17.75 9.84 18.84 11.07 18.82 12.58C18.82 14.08 17.75 15.31 16.38 15.31Z"
                            Foreground="{ThemeResource TextFillColorPrimaryBrush}" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsDiscordRichPresenceEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="About" />

                <controls:SettingsExpander
                    Header="About Nagi"
                    Description="Rediscover your local music collection with Nagi, a music player focused on speed, simplicity, and privacy."
                    IsExpanded="False">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE946;" />
                    </controls:SettingsExpander.HeaderIcon>
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        IsTextSelectionEnabled="True">
                        <Run Text="Version " />
                        <Run Text="{x:Bind ViewModel.ApplicationVersion, Mode=OneWay}" />
                    </TextBlock>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard ContentAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <HyperlinkButton
                                    Content="View Licenses"
                                    NavigateUri="https://github.com/Anthonyy232/Nagi/blob/master/LICENSE" />
                                <HyperlinkButton
                                    Content="Source Code"
                                    NavigateUri="https://github.com/Anthonyy232/Nagi" />
                            </StackPanel>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <controls:SettingsCard
                    Header="Check for updates on startup"
                    Description="Automatically check for new versions when the application starts."
                    Visibility="{x:Bind ViewModel.IsUpdateControlVisible, Mode=OneWay}">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE117;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        HorizontalAlignment="Right"
                        IsOn="{x:Bind ViewModel.IsCheckForUpdatesEnabled, Mode=TwoWay}" />
                </controls:SettingsCard>

                <StackPanel
                    Margin="0,8,0,0"
                    Orientation="Horizontal"
                    Spacing="12">
                    <HyperlinkButton
                        Command="{x:Bind ViewModel.CheckForUpdatesManuallyCommand}"
                        Content="Check for Updates"
                        Visibility="{x:Bind ViewModel.IsUpdateControlVisible, Mode=OneWay}" />
                    <HyperlinkButton
                        Content="Send Feedback"
                        NavigateUri="mailto:anthonyyla.dev@gmail.com" />
                </StackPanel>
            </StackPanel>
        </ScrollView>
    </Grid>
</Page>