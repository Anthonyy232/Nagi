<Page
    x:Class="Nagi.WinUI.Pages.LyricsPage"
    x:Name="lyricsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:Nagi.WinUI.ViewModels"
    xmlns:core="using:Nagi.Core.Models.Lyrics"
    xmlns:converters="using:Nagi.WinUI.Converters"
    mc:Ignorable="d"
    Loaded="LyricsPage_Loaded">

    <Page.Resources>
        <!-- Styles -->
        <Style x:Key="LyricLineStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorTertiaryBrush}" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="Margin" Value="0,10" />
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="TextTrimming" Value="None" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="Opacity" Value="0.7" />
            <Setter Property="LineHeight" Value="28" />
        </Style>

        <Style x:Key="HighlightedLyricLineStyle" TargetType="TextBlock" BasedOn="{StaticResource LyricLineStyle}">
            <Setter Property="FontSize" Value="28" />
            <Setter Property="Foreground" Value="{ThemeResource AccentTextFillColorPrimaryBrush}" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Opacity" Value="1.0" />
            <Setter Property="LineHeight" Value="36" />
        </Style>

        <!-- Converters -->
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:BooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" Invert="True" />
        <converters:ActiveLyricToStyleConverter
            x:Key="ActiveLyricToStyleConverter"
            ActiveStyle="{StaticResource HighlightedLyricLineStyle}"
            InactiveStyle="{StaticResource LyricLineStyle}" />

        <!-- Animations -->
        <Storyboard x:Key="PageLoadStoryboard">
            <DoubleAnimation
            Storyboard.TargetName="LyricsContainer"
            Storyboard.TargetProperty="Opacity"
            From="0" To="1" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="3"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Page.Resources>

    <Grid x:Name="LyricsContainer" Opacity="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            Margin="0,32,0,8"
            Style="{StaticResource TitleTextBlockStyle}"
            Text="{x:Bind ViewModel.SongTitle, Mode=OneWay}"
            FontWeight="SemiBold"
            HorizontalAlignment="Center"
            TextTrimming="CharacterEllipsis"
            MaxLines="1"
            MaxWidth="1200">
        </TextBlock>

        <ProgressBar
            x:Name="LyricsProgressBar"
            Grid.Row="1"
            Height="2"
            Margin="100,16,100,24"
            Maximum="100"
            Foreground="{ThemeResource AccentFillColorDefaultBrush}"
            Visibility="{x:Bind ViewModel.HasLyrics, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
            MaxWidth="600">
        </ProgressBar>

        <ListView
            x:Name="LyricsListView"
            Grid.Row="2"
            Padding="0,24"
            ItemsSource="{x:Bind ViewModel.LyricLines, Mode=OneWay}"
            Background="Transparent"
            SelectionMode="None"
            IsItemClickEnabled="False"
            HorizontalContentAlignment="Stretch"
            Visibility="{x:Bind ViewModel.HasLyrics, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="core:LyricLine">
                    <TextBlock
                        Text="{x:Bind Text}"
                        Style="{x:Bind IsActive, Mode=OneWay, Converter={StaticResource ActiveLyricToStyleConverter}}">
                    </TextBlock>
                </DataTemplate>
            </ListView.ItemTemplate>

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0,4"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <StackPanel
            Grid.Row="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Visibility="{x:Bind ViewModel.HasLyrics, Mode=OneWay, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <FontIcon
                Glyph="î¢²"
                FontSize="36"
                Margin="0,0,0,16"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            <TextBlock
                Style="{StaticResource SubtitleTextBlockStyle}"
                Text="No timed lyrics found for this track"
                HorizontalAlignment="Center" />
            <TextBlock
                Style="{StaticResource BodyTextBlockStyle}"
                Text="Try another song or check back later"
                HorizontalAlignment="Center"
                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                Margin="0,8,0,0" />
        </StackPanel>
    </Grid>
</Page>